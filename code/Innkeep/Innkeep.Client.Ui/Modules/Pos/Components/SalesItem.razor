@using System.Globalization
@using Innkeep.Api.Models.Internal

<MudPaper Class="flex-grow-1 m-1 no-highlight" Style="max-height: 15% !important" @onclick="OnClickCallback" Elevation="0">
    <MudStack Row="true" Class="h-100">
        <MudStack Class="p-2 h-100" Style="width: 75% !important;" Spacing="0" Justify="Justify.Center">
            <MudText>@Item.Name</MudText>
            @if (Item.TaxRate > 0)
            {
                <MudText Color="Color.Secondary" Typo="Typo.body2">@Item.TaxRate %</MudText>
            }
            @if (!Item.Infinite)
            {
                <MudStack Spacing="0" Row="true" Class="p-0 m-0" AlignItems="AlignItems.Center">
                    <MudProgressLinear Class="w-50" Max="Item.QuotaMax!.Value" Value="Item.QuotaSold!.Value" Color="GetColor()">
                    </MudProgressLinear>
                    <MudText Typo="Typo.body2" Class="pl-4">@Item.QuotaLeft / @Item.QuotaMax Available</MudText>
                </MudStack>
            }
        </MudStack>
        <MudDivider Vertical="true" FlexItem="true" Style="width: 2px; height: 100%"/>
        <MudStack Class="px-3" Spacing="0" Justify="Justify.Center" AlignItems="AlignItems.End" Style="width: 18%">
            <MudText Color="Color.Primary" Typo="Typo.h6">@Item.PriceWithTax.ToString("F2", CultureInfo.InvariantCulture)</MudText>
            <MudText Color="Color.Primary" Typo="Typo.h6">@Item.Currency</MudText>
        </MudStack>
    </MudStack>
</MudPaper>

@code {

    [Parameter]
    public required DtoSalesItem Item { get; set; }
    
    [Parameter]
    public EventCallback OnClickCallback { get; set; }

    public Color GetColor()
    {
        return Item.SoldOut ? Color.Error : Color.Primary;
    }
}